!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","load-image-meta","load-image-exif","load-image-ios","canvas-to-blob","./jquery.fileupload-process"],t):t(window.jQuery,window.loadImage)}(function(t,e){"use strict";t.blueimp.fileupload.prototype.options.processQueue.unshift({action:"loadImageMetaData",disableImageHead:"@",disableExif:"@",disableExifThumbnail:"@",disableExifSub:"@",disableExifGps:"@",disabled:"@disableImageMetaDataLoad"},{action:"loadImage",prefix:!0,fileTypes:"@",maxFileSize:"@",noRevoke:"@",disabled:"@disableImageLoad"},{action:"resizeImage",prefix:"image",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",disabled:"@disableImageResize"},{action:"saveImage",disabled:"@disableImageResize"},{action:"saveImageMetaData",disabled:"@disableImageMetaDataSave"},{action:"resizeImage",prefix:"preview",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",thumbnail:"@",canvas:"@",disabled:"@disableImagePreview"},{action:"setImage",name:"@imagePreviewName",disabled:"@disableImagePreview"}),t.widget("blueimp.fileupload",t.blueimp.fileupload,{options:{loadImageFileTypes:/^image\/(gif|jpeg|png)$/,loadImageMaxFileSize:1e7,imageMaxWidth:1920,imageMaxHeight:1080,imageOrientation:!1,imageCrop:!1,disableImageResize:!0,previewMaxWidth:80,previewMaxHeight:80,previewOrientation:!0,previewThumbnail:!0,previewCrop:!1,previewCanvas:!0},processActions:{loadImage:function(i,a){if(a.disabled)return i;var s=this,n=i.files[i.index],r=t.Deferred();return"number"===t.type(a.maxFileSize)&&n.size>a.maxFileSize||a.fileTypes&&!a.fileTypes.test(n.type)||!e(n,function(t){t.src&&(i.img=t),r.resolveWith(s,[i])},a)?i:r.promise()},resizeImage:function(i,a){if(a.disabled)return i;a=t.extend({canvas:!0},a);var s,n=this,r=t.Deferred(),o=a.canvas&&i.canvas||i.img,h=function(t){!t||t.width===o.width&&t.height===o.height||(i[t.getContext?"canvas":"img"]=t),i.preview=t,r.resolveWith(n,[i])};return i.exif&&(a.orientation===!0&&(a.orientation=i.exif.get("Orientation")),a.thumbnail&&(s=i.exif.get("Thumbnail")))?(e(s,h,a),r.promise()):o?(h(e.scale(o,a)),r.promise()):i},saveImage:function(e,i){if(!e.canvas||i.disabled)return e;var a=this,s=e.files[e.index],n=s.name,r=t.Deferred(),o=function(t){t.name||(s.type===t.type?t.name=s.name:s.name&&(t.name=s.name.replace(/\..+$/,"."+t.type.substr(6)))),e.files[e.index]=t,r.resolveWith(a,[e])};if(e.canvas.mozGetAsFile)o(e.canvas.mozGetAsFile(/^image\/(jpeg|png)$/.test(s.type)&&n||(n&&n.replace(/\..+$/,"")||"blob")+".png",s.type));else{if(!e.canvas.toBlob)return e;e.canvas.toBlob(o,s.type)}return r.promise()},loadImageMetaData:function(i,a){if(a.disabled)return i;var s=this,n=t.Deferred();return e.parseMetaData(i.files[i.index],function(e){t.extend(i,e),n.resolveWith(s,[i])},a),n.promise()},saveImageMetaData:function(t,e){if(!(t.imageHead&&t.canvas&&t.canvas.toBlob)||e.disabled)return t;var i=t.files[t.index],a=new Blob([t.imageHead,this._blobSlice.call(i,20)],{type:i.type});return a.name=i.name,t.files[t.index]=a,t},setImage:function(t,e){return t.preview&&!e.disabled&&(t.files[t.index][e.name||"preview"]=t.preview),t}}})});